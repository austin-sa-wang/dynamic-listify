"use strict";angular.module("LiveSearchApp",["liveSearchList","liveSearchListContainer","lsSearchBar","ifChrome"]),angular.module("liveSearchList",[]).controller("LiveSearchListCtrl",function(){this.filterExpr="",this.display=!0,this.icon="octicon octicon-chevron-down",this.toggleList=function(){this.display?(this.display=!1,this.icon="octicon octicon-chevron-right"):(this.display=!0,this.icon="octicon octicon-chevron-down")}}).directive("liveSearchList",["ListExtractionFactory",function(a){return{scope:{listNumber:"@"},templateUrl:"scripts/list/live-search-list.html",controller:"LiveSearchListCtrl",controllerAs:"ctrl",link:function(b,c){var d=c.children("div")[0],e=a.lists[b.listNumber],f=a.separateTableIntoContainerAndContent(e),g=f.container,h=f.content;g.classList.add("table"),g.classList.add("table-condensed");var i=h.children[0];if("TH"===i.children[0].tagName){var j=g.appendChild(document.createElement("thead"));j.appendChild(i)}d.appendChild(g),g.appendChild(h);var k=function(a,b){var c=a.parentNode,d=a.nextSibling;c.removeChild(a);var e;try{e=b()}finally{c.insertBefore(a,d)}return e},l=function(a){k(a,function(){for(var c,d=new RegExp(b.ctrl.filterExpr,"i"),e=a.children,f=0;f<e.length;f++)c=$(e[f]),d.exec(c.text())?c.css("display",""):c.css("display","none")})};b.$watch("ctrl.filterExpr",function(){l(h)})}}}]),angular.module("liveSearchListContainer",[]).directive("liveSearchListContainer",["$compile","ListExtractionFactory",function(a,b){return{scope:{},link:function(c,d){var e=function(b,e){d.empty();for(var f,g,h=0;e>h;h++)f='<div live-search-list="" list-number="'+h+'"></div>',g=a(f)(c),d.append(g)};b.listen(e)}}}]),angular.module("lsSearchBar",["listExtractionFactory","ui.bootstrap"]).controller("lsSearchBarCtrl",["$scope","$timeout","ListExtractionFactory",function(a,b,c){var d="Try again. Extraction failed.",e="No table found on target page. If there IS a table, then the table implementation is not supported. This app finds tables by the HTML <table> element.",f="Try a different web page. The app is unable to retrieve source data due to cross-origin resource sharing restrictions.",g="Processing...";this.srcUrl="",this.alert={show:!1,type:"",count:0,msg:d};var h=this.alert,i=function(){h.count>1?(h.msg=f,h.type="danger"):(h.msg=d,h.type=""),h.show=!0,h.count++},j=function(){h.show=!0,h.type="",h.msg=e,h.count=0},k=function(){h.show=!0,h.type="",h.msg=g};c.listen(function(a,c){0===c&&b(function(){j()})}),this.getTables=function(){k(),c.extract(this.srcUrl).success(function(){h.show=!1,h.count=0}).error(i)},this.setUrl=function(a){this.srcUrl=a,this.getTables()}}]).directive("lsSearchBar",function(){return{scope:{},templateUrl:"scripts/search_bar/ls-search-bar.html",controller:"lsSearchBarCtrl",controllerAs:"ctrl"}}),angular.module("listExtractionFactory",[]).factory("ListExtractionFactory",["$http","$rootScope",function a(b,c){a.EVENT_NAME="lists:ready",a.MIN_CHILD_COUNT_TO_QUALITY=10,a.lists=[];var d=function(b){a.lists.push(b)},e=function(a){var b="http://www.corsproxy.com/",c=a;return-1!=a.search("https://")?c=a.substr(8):-1!=a.search("http://")&&(c=a.substr(7)),console.log("extract from"+b+c),b+c};return a.broadcast=function(b){c.$broadcast(a.EVENT_NAME,b)},a.listen=function(b){c.$on(a.EVENT_NAME,b)},a.fixRelativeLinks=function(a,b){var c=document.createElement("a");c.href=a;var d=c.hostname,e="";-1!=a.search("https://")?e="https://":-1!=a.search("http://")&&(e="http://");var f=/href="\//g,g='href="'+e+d+"/",h=/src="\//g,i='src="'+e+d+"/",j=b.replace(f,g);return j=j.replace(h,i)},a.getTables=function(b){var c=0,e=document.createElement("div");e.innerHTML=b;var f=e.getElementsByTagName("table");a.lists=[];for(var g,h,i,j=0;j<f.length;)g=f[j],h=g.getElementsByTagName("tbody")[0].children.length,h>a.MIN_CHILD_COUNT_TO_QUALITY?(i=g.parentNode.removeChild(g),d(i),c++):j++;return console.log("Found "+c+" tables"),c},a.extract=function(c){var d=b.get(e(c)).success(function(b){var d=a.fixRelativeLinks(c,b),e=a.getTables(d);a.broadcast(e)});return d},a.separateTableIntoContainerAndContent=function(a){var b=a.getElementsByTagName("tbody")[0],c=a.removeChild(b);return{container:a,content:c}},a}]),angular.module("ifChrome",[]).directive("ifChrome",function(){return{compile:function(a){var b=/chrome/i.test(navigator.userAgent);b&&a.removeClass("hidden")}}});